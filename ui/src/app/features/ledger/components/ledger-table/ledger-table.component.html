<div class="ledger-table-container">
  <table mat-table [dataSource]="transactionsWithBalance" class="ledger-table">
    <!-- Transaction Date Column -->
    <ng-container matColumnDef="transactionDate">
      <th mat-header-cell *matHeaderCellDef>Date</th>
      <td mat-cell *matCellDef="let transaction">
        {{ transaction.transactionDate | dateFormat }}
      </td>
    </ng-container>

    <!-- Transaction Type Column -->
    <ng-container matColumnDef="transactionType">
      <th mat-header-cell *matHeaderCellDef>Type</th>
      <td mat-cell *matCellDef="let transaction">
        <div class="type-cell">
          <mat-icon class="type-icon">{{ getTransactionIcon(transaction.transactionType) }}</mat-icon>
          <app-status-badge [status]="transaction.transactionType" [type]="'transaction'"></app-status-badge>
        </div>
      </td>
    </ng-container>

    <!-- Description Column -->
    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef>Description</th>
      <td mat-cell *matCellDef="let transaction">
        <div class="description-cell">
          <span class="description-text">{{ transaction.description }}</span>
          <span class="reference-text" *ngIf="transaction.referenceId">
            Ref: {{ transaction.referenceId }}
          </span>
        </div>
      </td>
    </ng-container>

    <!-- Debit Column -->
    <ng-container matColumnDef="debit">
      <th mat-header-cell *matHeaderCellDef class="number-column">Debit</th>
      <td mat-cell *matCellDef="let transaction" class="number-column">
        <span class="debit-amount" *ngIf="getTotalDebit(transaction) > 0">
          {{ getTotalDebit(transaction) | currencyFormat }}
        </span>
      </td>
    </ng-container>

    <!-- Credit Column -->
    <ng-container matColumnDef="credit">
      <th mat-header-cell *matHeaderCellDef class="number-column">Credit</th>
      <td mat-cell *matCellDef="let transaction" class="number-column">
        <span class="credit-amount" *ngIf="getTotalCredit(transaction) > 0">
          {{ getTotalCredit(transaction) | currencyFormat }}
        </span>
      </td>
    </ng-container>

    <!-- Running Balance Column -->
    <ng-container matColumnDef="runningBalance">
      <th mat-header-cell *matHeaderCellDef class="number-column">Balance</th>
      <td mat-cell *matCellDef="let transaction" class="number-column">
        <span
          class="balance-amount"
          [class.negative]="transaction.runningBalance && transaction.runningBalance < 0"
          *ngIf="showRunningBalance && transaction.runningBalance !== undefined"
        >
          {{ transaction.runningBalance | currencyFormat }}
        </span>
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let transaction">
        <button
          mat-icon-button
          (click)="onTransactionClick(transaction)"
          matTooltip="View details"
        >
          <mat-icon>visibility</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      class="ledger-row"
      tabindex="0"
      (click)="onTransactionClick(row)"
      (keydown)="onTransactionClick(row)"
    ></tr>
  </table>

  <mat-paginator
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="[10, 25, 50, 100]"
    (page)="onPageChange($event)"
    showFirstLastButtons
  ></mat-paginator>
</div>
